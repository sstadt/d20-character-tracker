
<div class="game">
  <!-- menu -->
  <toolbar :game="gameId">
    <span slot="topbar">
      <md-button class="md-icon-button" v-if="userIsGameMaster" @click="openMenu('crawl')"><icon name="crawl"></icon></md-button>
      <md-button class="md-icon-button" v-if="userIsGameMaster" @click="openMenu('players')"><icon name="rebel"></icon></md-button>
      <md-button class="md-icon-button" v-if="userIsGameMaster" @click="openMenu('settings')"><icon name="empire"></icon></md-button>

      <md-menu v-if="userIsGameMaster" md-direction="bottom left" :md-align-trigger="true" md-size="4">
        <md-button class="md-icon-button" md-menu-trigger><icon name="dl44"></icon></md-button>
        <md-menu-content>
          <md-menu-item @click="rollDestinyPool">Roll Destiny Tokens</md-menu-item>
        </md-menu-content>
      </md-menu>
    </span>
  </toolbar>

  <!-- music player -->
  <jukebox :playlist="playlist" ref="jukebox" @track-finished="trackFinished"></jukebox>

  <!-- notifications -->
  <notification ref="notifications"></notification>

  <!-- party -->
  <party :game="game" @error="notifyError"></party>

  <!-- chat window and dice controls -->
  <div class="panel main-window flex-column">
    <div class="chat-container fill-height">
      <chat v-if="gameLog.log" :log="gameLog.log" :game="game.id" @play-crawl="playCrawl"></chat>
      <md-spinner v-else :md-size="150" :md-stroke="1" md-indeterminate></md-spinner>
    </div>
    <div class="dice-pool-container no-shrink">
      <dice-pool ref="dicePool" :game="game.id" @error="notifyError"></dice-pool>
      <dice-controls @die-click="addDieToPool"></dice-controls>
      <destiny-tokens :is-game-master="userIsGameMaster" :light="lightTokens" :dark="darkTokens"></destiny-tokens>
    </div>
  </div>

  <!-- crawl -->
  <star-wars-crawl
    :title="activeCrawl.title"
    :subtitle="activeCrawl.subtitle"
    :body="activeCrawl.crawl"
    :image="activeCrawl.image"
    @play-music="playMusic"
    @stop-music="stopMusic"
    ref="crawl">
  </star-wars-crawl>

  <!-- crawl menu -->
  <md-dialog ref="crawlDialog">
    <md-dialog-title>
      <p>{{ game.title }} Crawls</p>
      <p class="subtitle"><small>Customizable introductory Star Wars crawl animations. Can be sent to the game's chat window or shared with players.</small></p>
    </md-dialog-title>
    <md-dialog-content>
      <component
        v-if="userIsGameMaster"
        is="crawlMenu"
        :game="game"
        @close="closeMenu('crawl')"
        @play-crawl="playCrawl"
        @error="notifyError">
      </component>
    </md-dialog-content>
  </md-dialog>

  <!-- players menu -->
  <md-dialog ref="playersDialog">
    <md-dialog-title>
      <p>{{ game.title }} Players</p>
      <p class="subtitle"><small>Add, approve, or remove players from the game.</small></p>
    </md-dialog-title>
    <md-dialog-content>
      <component
        v-if="userIsGameMaster"
        is="playersMenu"
        :game="game"
        @close="closeMenu('players')"
        @error="notifyError">
      </component>
    </md-dialog-content>
  </md-dialog>

  <!-- game settings menu -->
  <md-dialog ref="settingsDialog">
    <md-dialog-title>
      <p>{{ game.title }} Settings</p>
      <p class="subtitle"><small>Game specific settings and configuration.</small></p>
    </md-dialog-title>
    <md-dialog-content>
      <component
        v-if="userIsGameMaster"
        is="settingsMenu"
        :game="game"
        @close="closeMenu('settings')"
        @error="notifyError">
      </component>
    </md-dialog-content>
  </md-dialog>
</div>
