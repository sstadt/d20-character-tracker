
<div class="panel-tint character">
  <transition name="slide-fade">
    <draggable-panel panel-id="character-card--test" v-show="show">
      <div class="card character-card" v-if="hasCharacter">

        <!-- header -->
        <div class="flex-row character-card-header">
          <!-- <h2 class="heading fill-width ellipsis">{{ character.name }}</h2> -->
          <input type="text" class="card-input header-input fill-width" v-model="character.name" />
          <md-spinner md-indeterminate :md-size="20" v-if="saving"></md-spinner>
          <md-button class="md-icon-button" @click.native="close()"><md-icon>close</md-icon></md-button>
        </div>

        <!-- card tabs -->
        <ul class="card-nav">
          <li :class="{ 'active': currentView === 'main' }">
            <md-button class="md-icon-button" @click.native="setView('main')"><icon name="user"></icon></md-button>
          </li>
          <li :class="{ 'active': currentView === 'skills' }">
            <md-button class="md-icon-button" @click.native="setView('skills')"><icon name="skills"></icon></md-button>
          </li>
          <li :class="{ 'active': currentView === 'inventory' }">
            <md-button class="md-icon-button" @click.native="setView('inventory')"><icon name="inventory"></icon></md-button>
          </li>
          <li :class="{ 'active': currentView === 'notes' }">
            <md-button class="md-icon-button" @click.native="setView('notes')"><icon name="notes"></icon></md-button>
          </li>
        </ul>

        <!-- character dashboard -->
        <div class="card-content" v-if="currentView === 'main'">
          <div class="character-dashboard-grid">
            <div class="character-dashboard-portrait">
              <image-finder aspect="portrait" v-model="character.imageUrl"></image-finder>
            </div>
            <div class="character-dashboard-details">
              <div class="row">
                <div class="small-3 column">
                  <md-input-container>
                    <label>Race</label>
                    <md-input type="text" v-model="character.race"></md-input>
                  </md-input-container>
                </div>
                <div class="small-3 column">
                  <md-input-container>
                    <label>Career</label>
                    <md-input type="text" v-model="character.career"></md-input>
                  </md-input-container>
                </div>
                <div class="small-6 column">
                  <md-input-container>
                    <label>Spacializations</label>
                    <md-input type="text" v-model="character.specialization"></md-input>
                  </md-input-container>
                </div>
              </div>
            </div>
            <div class="character-dashboard-stats">
              <div class="character-stats-grid">
                <div class="character-stats-brawn">
                  <stat-input v-model="character.brawn" label="Brawn"></stat-input>
                </div>
                <div class="character-stats-agility">
                  <stat-input v-model="character.agility" label="Agility"></stat-input>
                </div>
                <div class="character-stats-intellect">
                  <stat-input v-model="character.intellect" label="Intellect"></stat-input>
                </div>
                <div class="character-stats-cunning">
                  <stat-input v-model="character.cunning" label="Cunning"></stat-input>
                </div>
                <div class="character-stats-willpower">
                  <stat-input v-model="character.willpower" label="Willpower"></stat-input>
                </div>
                <div class="character-stats-presence">
                  <stat-input v-model="character.presence" label="Presence"></stat-input>
                </div>
                <div class="character-stats-wounds">
                  <div class="stat-input-group">
                    <stat-input v-model="character.currentWounds" label="Wounds"></stat-input>
                    <stat-input v-model="character.woundThreshold" label="Threshold" icon="wounds"></stat-input>
                  </div>
                </div>
                <div class="character-stats-strain">
                  <div class="stat-input-group">
                    <stat-input v-model="character.currentStrain" label="Strain"></stat-input>
                    <stat-input v-model="character.strainThreshold" label="Threshold" icon="strain"></stat-input>
                  </div>
                </div>
                <div class="character-stats-defense">
                  <div class="stat-input-group thirds">
                    <stat-input v-model="character.soak" label="Soak"></stat-input>
                    <stat-input v-model="character.defenseMelee" label="Melee" :divider="true"></stat-input>
                    <stat-input v-model="character.defenseRanged" label="Range" icon="defense"></stat-input>
                  </div>
                </div>
                <div class="character-stats-force-rating">
                  <stat-input v-model="character.forceRating" label="Force Rating"></stat-input>
                </div>
                <div class="character-stats-conflict">
                  <stat-input v-model="character.conflict" label="Conflict"></stat-input>
                </div>
                <div class="character-stats-experience">
                  <div class="stat-input-group vertical">
                    <stat-input v-model="character.spentExperience" label="Spent XP"></stat-input>
                    <stat-input v-model="character.experience" label="Total XP"></stat-input>
                  </div>
                </div>
              </div>
            </div>
            <div class="character-dashboard-shortcuts flex-column">
              <h3 class="mt-0">Quick Skills</h3>
              <div class="fill-height">
                <div class="scroll-y expand">
                  <skill-shortcut
                    v-for="(skill, index) in quickSkills"
                    v-model="skill.rank"
                    :name="skill.name"
                    :ability="character[skill.ability]"
                    :key="skill.name"
                    :icon="false">
                  </skill-shortcut>
                </div>
              </div>
            </div>
            <div class="character-dashboard-talents flex-column">
              <h3 class="mt-0">Talents</h3>
              <div class="fill-height">
                <div class="scroll-y expand">
                  <p>coming soon</p>
                </div>
              </div>
            </div>
            <div class="character-dashboard-weapons flex-column">
              <h3 class="mt-0">Weapons</h3>
              <div class="fill-height">
                <div class="scroll-y expand">
                  <div class="weapon-shortcut" v-for="weapon in equippedWeapons" :key="weapon.id">
                    <div class="flex-row">
                      <md-button class="md-icon-button"><icon name="rebel"></icon></md-button>
                      <div class="fill-width details">
                        <p class="mt-0 mb-0 ellipsis title">{{ weapon.name }}</p>
                        <md-tooltip>
                          <strong>{{ weapon.name }}</strong><br/>
                          Damage: {{ weapon.damage }}<br/>
                          Crit: {{ weapon.crit }}<br/>
                          Range: {{ weapon.range }}
                        </md-tooltip>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- character skills/abilities -->
        <div class="card-content" v-show="currentView === 'skills'">
          <div class="character-skills-grid">
            <div class="character-skills-general">
              <skill-shortcut
                v-for="(skill, index) in generalSkills"
                v-model="skill.rank"
                :name="skill.name"
                :ability="character[skill.ability]"
                :key="skill.name"
                :edit="canEdit"
                :icon="false">
              </skill-shortcut>
            </div>
            <div class="character-skills-knowledge">
              <skill-shortcut
                v-for="(skill, index) in knowledgeSkills"
                v-model="skill.rank"
                :name="skill.name"
                :ability="character[skill.ability]"
                :key="skill.name"
                :edit="canEdit"
                :icon="false">
              </skill-shortcut>
            </div>
            <div class="character-skills-combat">
              <skill-shortcut
                v-for="(skill, index) in combatSkills"
                v-model="skill.rank"
                :name="skill.name"
                :ability="character[skill.ability]"
                :key="skill.name"
                :edit="canEdit"
                :icon="false">
              </skill-shortcut>
            </div>
            <div class="character-skills-talents scroll-y">
              <div class="character-talent" v-for="talent in character.talents" :key="talent.id">
                <div class="flex-row">
                  <h4 class="title fill-width">{{ talent.name }}</h4>
                  <md-menu md-direction="bottom left" :md-align-trigger="true" md-size="4" v-if="canEdit">
                    <md-button class="md-icon-button" md-menu-trigger><md-icon>more_horiz</md-icon></md-button>
                    <md-menu-content>
                      <md-menu-item @selected="editTalent(talent)">Edit</md-menu-item>
                      <confirm-menu-item @submit="deleteTalent(talent.id)"></confirm-menu-item>
                    </md-menu-content>
                  </md-menu>
                </div>
                <div class="description">
                  <markdown :content="talent.description"></markdown>
                </div>
              </div>
              <md-button class="block-align-center gutter-top" @click.native="addTalent">Add Talent/Power</md-button>
            </div>
          </div>
        </div>

        <!-- character inventory -->
        <div class="card-content" v-show="currentView === 'inventory'">
          <div class="flex-column">
            <div class="flex-item-50">
              <div class="flex-column">
                <div class="no-shrink">
                  <h3 class="card-section-header">Weapons</h3>
                  <md-button class="md-icon-button" @click.native="addEquipment('weapon')" v-if="canEdit"><md-icon>add</md-icon></md-button>
                </div>
                <div class="flex-item fixed-header">
                  <div class="header">
                    <div class="row">
                      <div class="small-3 columns">Name</div>
                      <div class="small-2 columns">Skill</div>
                      <div class="small-2 columns">Range</div>
                      <div class="small-1 columns">Dmg</div>
                      <div class="small-1 columns">Crit</div>
                      <div class="small-1 columns">Enc</div>
                      <div class="small-1 columns">
                        <icon name="user"></icon>
                        <md-tooltip md-direction="bottom">Equipped</md-tooltip>
                      </div>
                      <div class="small-1 columns"></div>
                    </div>
                  </div>
                  <div class="scroll-content">
                    <div class="row" v-for="item in character.equipment" v-if="item.type === 'weapon'" :key="item.id">
                      <div class="small-3 columns ellipsis">
                        {{ item.name }}
                        <md-tooltip md-direction="bottom" v-if="item.description !== ''">
                          <markdown :content="item.description"></markdown>
                        </md-tooltip>
                      </div>
                      <div class="small-2 columns">{{ item.skill }}</div>
                      <div class="small-2 columns">{{ item.range }}</div>
                      <div class="small-1 columns">{{ item.damage }}</div>
                      <div class="small-1 columns">{{ item.crit }}</div>
                      <div class="small-1 columns">{{ item.encumbrance }}</div>
                      <div class="small-1 columns"><md-checkbox v-model="item.equipped"></md-checkbox></div>
                      <div class="small-1 columns">
                        <md-menu md-direction="bottom left" :md-align-trigger="true" md-size="4" v-if="canEdit">
                          <md-button class="md-icon-button" md-menu-trigger><md-icon>more_horiz</md-icon></md-button>
                          <md-menu-content>
                            <md-menu-item @selected="editEquipment(item)">Edit</md-menu-item>
                            <confirm-menu-item @submit="deleteEquipment(item.id)"></confirm-menu-item>
                          </md-menu-content>
                        </md-menu>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="flex-item-50">
              <div class="row">
                <div class="small-7 column">
                  <div class="flex-column">
                    <div class="no-shrink">
                      <h3 class="card-section-header">Armor</h3>
                      <md-button class="md-icon-button" @click.native="addEquipment('armor')"><md-icon>add</md-icon></md-button>
                    </div>
                    <div class="flex-item fixed-header">
                      <div class="header">
                        <div class="row">
                          <div class="small-7 columns">Name</div>
                          <div class="small-1 columns">Def</div>
                          <div class="small-1 columns">Sk</div>
                          <div class="small-1 columns">Enc</div>
                          <div class="small-1 columns">
                            <icon name="user"></icon>
                            <md-tooltip md-direction="bottom">Equipped</md-tooltip>
                          </div>
                          <div class="small-1 columns"></div>
                        </div>
                      </div>
                      <div class="scroll-content">
                        <div class="row" v-for="item in character.equipment" v-if="item.type === 'armor'" :key="item.id">
                          <div class="small-7 columns ellipsis">
                            {{ item.name }}
                            <md-tooltip md-direction="bottom" v-if="item.description !== ''">
                              <markdown :content="item.description"></markdown>
                            </md-tooltip>
                          </div>
                          <div class="small-1 columns">{{ item.defense }}</div>
                          <div class="small-1 columns">{{ item.soak }}</div>
                          <div class="small-1 columns">{{ item.encumbrance }}</div>
                          <div class="small-1 columns"><md-checkbox v-model="item.equipped"></md-checkbox></div>
                          <div class="small-1 columns">
                            <md-menu md-direction="bottom left" :md-align-trigger="true" md-size="4" v-if="canEdit">
                              <md-button class="md-icon-button" md-menu-trigger><md-icon>more_horiz</md-icon></md-button>
                              <md-menu-content>
                                <md-menu-item @selected="editEquipment(item)">Edit</md-menu-item>
                                <confirm-menu-item @submit="deleteEquipment(item.id)"></confirm-menu-item>
                              </md-menu-content>
                            </md-menu>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="small-5 column">
                  <div class="flex-column">
                    <div class="no-shrink">
                      <h3 class="card-section-header">Gear</h3>
                      <md-button class="md-icon-button" @click.native="addEquipment('gear')"><md-icon>add</md-icon></md-button>
                    </div>
                    <div class="flex-item fixed-header">
                      <div class="header">
                        <div class="row">
                          <div class="small-6 columns">Name</div>
                          <div class="small-2 columns">Enc</div>
                          <div class="small-2 columns">
                            <icon name="user"></icon>
                            <md-tooltip md-direction="bottom">Equipped</md-tooltip>
                          </div>
                          <div class="small-2 columns"></div>
                        </div>
                      </div>
                      <div class="scroll-content">
                        <div class="row" v-for="item in character.equipment" v-if="item.type === 'gear'" :key="item.id">
                          <div class="small-6 columns ellipsis">
                            {{ item.name }}
                            <md-tooltip md-direction="bottom" v-if="item.description !== ''">
                              <markdown :content="item.description"></markdown>
                            </md-tooltip>
                          </div>
                          <div class="small-2 columns">{{ item.encumbrance }}</div>
                          <div class="small-2 columns"><md-checkbox v-model="item.equipped"></md-checkbox></div>
                          <div class="small-2 columns">
                            <md-menu md-direction="bottom left" :md-align-trigger="true" md-size="4" v-if="canEdit">
                              <md-button class="md-icon-button" md-menu-trigger><md-icon>more_horiz</md-icon></md-button>
                              <md-menu-content>
                                <md-menu-item @selected="editEquipment(item)">Edit</md-menu-item>
                                <confirm-menu-item @submit="deleteEquipment(item.id)"></confirm-menu-item>
                              </md-menu-content>
                            </md-menu>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- character notes -->
        <div class="card-content" v-show="currentView === 'notes'">
          <div class="character-notes-grid">
            <div class="character-notes-public flex-column">
              <label>Description (public)</label>
              <textarea class="card-input fill-height" v-model="character.description"></textarea>
            </div>
            <div class="character-notes-private flex-column">
              <label>Notes</label>
              <textarea class="card-input fill-height" v-model="character.notes"></textarea>
            </div>
          </div>
        </div>

      </div>
    </draggable-panel>
  </transition>

  <!-- Talent Editor -->
  <md-dialog ref="talentDialog" class="wide">
    <md-dialog-title>
      <p>Talent</p>
    </md-dialog-title>
    <md-dialog-content>
      <form @submit.stop.prevent="saveTalent">
        <div class="row">
          <div class="small-12 column">
            <md-input-container>
              <label>Name</label>
              <md-input type="text" v-model="currentTalent.name"></md-input>
            </md-input-container>
          </div>
        </div>
        <div class="row">
          <div class="small-12 column">
            <md-input-container>
              <label>Description</label>
              <md-textarea v-model="currentTalent.description" type="text"></md-textarea>
            </md-input-container>
          </div>
        </div>
      </form>
    </md-dialog-content>
    <md-dialog-actions>
      <md-button class="md-primary" @click.native="closeDialog('talent')">Cancel</md-button>
      <md-button class="md-primary" @click.native="saveTalent(currentTalent)">Save</md-button>
    </md-dialog-actions>
  </md-dialog>

  <!-- Weapon Editor -->
  <md-dialog ref="weaponDialog">
    <md-dialog-title>
      <p>Weapon</p>
    </md-dialog-title>
    <md-dialog-content>
      <form @submit.stop.prevent="saveWeapon">
        <div class="row">
          <div class="small-12 column">
            <md-input-container>
              <label>Name</label>
              <md-input type="text" v-model="currentWeapon.name"></md-input>
            </md-input-container>
          </div>
        </div>
        <div class="row">
          <div class="small-6 column">
            <md-input-container>
              <label>Skill</label>
              <md-select v-model="currentWeapon.skill">
                <md-option v-for="skill in combatSkills" :value="skill.name" :key="skill.name">{{ skill.name }}</md-option>
              </md-select>
            </md-input-container>
          </div>
          <div class="small-6 column">
            <md-input-container>
              <label>Range</label>
              <md-select v-model="currentWeapon.range">
                <md-option v-for="range in rangeBands" :value="range" :key="range">{{ range }}</md-option>
              </md-select>
            </md-input-container>
          </div>
        </div>
        <div class="row">
          <div class="small-4 column">
            <number-picker v-model="currentWeapon.damage" label="Damage"></number-picker>
          </div>
          <div class="small-4 column">
            <number-picker v-model="currentWeapon.crit" label="Crit"></number-picker>
          </div>
          <div class="small-4 column">
            <number-picker v-model="currentWeapon.encumbrance" label="Encum"></number-picker>
          </div>
        </div>
        <div class="row">
          <div class="small-12 column">
            <md-input-container>
              <label>Notes</label>
              <md-textarea v-model="currentWeapon.description" type="text"></md-textarea>
            </md-input-container>
          </div>
        </div>
      </form>
    </md-dialog-content>
    <md-dialog-actions>
      <md-button class="md-primary" @click.native="closeDialog('weapon')">Cancel</md-button>
      <md-button class="md-primary" @click.native="saveEquipment(currentWeapon)">Save</md-button>
    </md-dialog-actions>
  </md-dialog>

  <!-- Armor Editor -->
  <md-dialog ref="armorDialog">
    <md-dialog-title>
      <p>Armor</p>
    </md-dialog-title>
    <md-dialog-content>
      <form @submit.stop.prevent="saveEquipment(currentArmor)">
        <div class="row">
          <div class="small-12 column">
            <md-input-container>
              <label>Name</label>
              <md-input type="text" v-model="currentArmor.name"></md-input>
            </md-input-container>
          </div>
        </div>
        <div class="row">
          <div class="small-4 column">
            <number-picker v-model="currentArmor.defense" label="Defense"></number-picker>
          </div>
          <div class="small-4 column">
            <number-picker v-model="currentArmor.soak" label="Soak"></number-picker>
          </div>
          <div class="small-4 column">
            <number-picker v-model="currentArmor.encumbrance" label="Encum"></number-picker>
          </div>
        </div>
        <div class="row">
          <div class="small-12 column">
            <md-input-container>
              <label>Notes</label>
              <md-textarea v-model="currentArmor.description" type="text"></md-textarea>
            </md-input-container>
          </div>
        </div>
      </form>
    </md-dialog-content>
    <md-dialog-actions>
      <md-button class="md-primary" @click.native="closeDialog('armor')">Cancel</md-button>
      <md-button class="md-primary" @click.native="saveEquipment(currentArmor)">Save</md-button>
    </md-dialog-actions>
  </md-dialog>

  <!-- Gear Editor -->
  <md-dialog ref="gearDialog">
    <md-dialog-title>
      <p>Gear</p>
    </md-dialog-title>
    <md-dialog-content>
      <form @submit.stop.prevent="saveEquipment(currentGear)">
        <div class="row">
          <div class="small-7 column">
            <md-input-container>
              <label>Name</label>
              <md-input type="text" v-model="currentGear.name"></md-input>
            </md-input-container>
          </div>
          <div class="small-5 column">
            <number-picker v-model="currentGear.encumbrance" label="Encum"></number-picker>
          </div>
        </div>
        <div class="row">
          <div class="small-12 column">
            <md-input-container>
              <label>Notes</label>
              <md-textarea v-model="currentGear.description" type="text"></md-textarea>
            </md-input-container>
          </div>
        </div>
      </form>
    </md-dialog-content>
    <md-dialog-actions>
      <md-button class="md-primary" @click.native="closeDialog('gear')">Cancel</md-button>
      <md-button class="md-primary" @click.native="saveEquipment(currentGear)">Save</md-button>
    </md-dialog-actions>
  </md-dialog>
</div>
